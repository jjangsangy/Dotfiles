#!/usr/bin/env python

import sys
import os

import matplotlib.pyplot as plt
from pandas import read_table

def header(data):
    with open(data, 'rt') as dat:
        return dat.readline().split()[-4:]

def main(data):
    # Header containing date of log creation
    month, day, time, year = header(data)

    # Pandas read table into DataFrame
    df = read_table(
            data,
            skiprows=6,
            header=0,
            comment='*',
            usecols=['topTemp', 'botTemp', 'chPress', 'MembPress', 'Force'])

    # Filename Parsing
    name = data.strip('.DAT').split('/')[-1].strip('Lid Bond').strip('BaseBond').strip()

    # Create the matplotlib figure
    fig, axes = plt.subplots(nrows=5, ncols=1, dpi=400)

    # Fill figure with data
    for iteration, param in enumerate(df.columns):
        df[param].plot(kind='line',
                       ax=axes[iteration],
                       figsize=(16,28),
                       title=param,
                       linewidth=2)

        # Prettyfy and format figure x/y axis
        axes[iteration].set_xlabel('{date}: {time}'.format(time=time, date=' '.join([month,day,year])), fontsize=14)
        axes[iteration].set_title('{var} vs Time'.format(var=param), fontsize=18)
        axes[iteration].set_ylabel(param, fontsize=16)
        axes[iteration].set_xticklabels('')

    # Save the plot with filename
    plt.savefig('{year} {month}_{day}_{name}.png'.format(year=year,month=month,day=day,name=name))


if __name__ == '__main__':
    # Check if file exists input as argv[1]
    if not os.path.isfile(sys.argv[1]):
        sys.stderr.write('file {0} does not exist\n'.format(sys.argv[1]))
        sys.exit(1)

    # Entry Point
    main(sys.argv[1])
