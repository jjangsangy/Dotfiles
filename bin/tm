#!/bin/bash
#
# FILE:         tm
# AUTHOR:       Sang Han
# VERSION:      1.1
# DESCRIPTION:  Deploy tmux enviornment
# DEPENDS:      tmux


usage() {
    cat <<- DOCUMENT

    $(basename $0) [-h help]

    Deploy custom tmux enviornment

    AUTHOR:     Sang Han
    YEAR:       2013
    VERSION:    1.1

    -h [help]
        Outputs usage directions
    -t [test]
        Run unit tests
    -w [work]
        Deploy custom work enviornment settings

DOCUMENT
    exit 0
}

test_names() {
    printf "\$WORK is %s\n" $WORK
    printf "\$SESSION is %s\n" $SESSION
    printf "\$TEST is %s\n" $TEST
}

work_session() {
    if [[ $WORK == 1 ]] && [[ $PATH =~ "Calient" ]]; then
        tmux send-keys -t $SESSION 'CalSMB' Enter
    fi
}


default_name() {
    # Set default name of session
    if [[ $WORK == 1 ]]; then
        export SESSION=${1:-work}
    else
        export SESSION=${1:-home}
    fi

    # Unit Tests
    if [[ $TEST == 1 ]]; then
        test_names
        exit
    fi

}

main() {
    tmux new-session -A -d -s $SESSION -n main
    tmux split-window -v -t $SESSION
    work_session
    tmux select-layout -t $SESSION main-vertical
    tmux select-pane -t :.+
    tmux attach -t $SESSION
}

# Parse Options
declare -i WORK=0 TEST=0
while getopts ':thw' OPTION; do
    case ${OPTION} in
        h) usage
            ;;
        w) WORK=1
            ;;
        t) TEST=1
            ;;
        ?) "Invalid option: -${OPTARG}" >&2
            exit 1
            ;;
    esac
done
    shift $((OPTIND-1))


if [[ "$0" == "${BASH_SOURCE}" ]]; then
    default_name ${1}
    main
fi
