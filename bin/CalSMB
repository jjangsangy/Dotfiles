#!/bin/bash
# CalSMB
# Sang Han
# Calient Technologies 2013
# MEMS Process Engineer

# This script logs into Calient Shares usually mounted on
# windows authenticated as Autoprober computer.

Autoprober="autoprober:autoprober"

function CalSMB () {
netbios="${1}"
share="${2}"
credentials="${3}"
if ! [[ -d /Volumes/"${share}" ]]; then
    echo "Mounting drive ${share}"
    mkdir /Volumes/"${share}" && mount -t smbfs -o soft //"${credentials}"@"${netbios}"/"${share/' '/%20}" /Volumes/"${share}" && echo "Mounting drive ${share} complete"
else
    echo "Drive ${share} already exists, unmounting"
    rmdir /Volumes/"${share}" || umount /Volumes/"${share}"
    echo "Mounting drive ${share}"
    mkdir /Volumes/"${share}" && mount -t smbfs -o soft //"${credentials}"@"${netbios}"/"${share/' '/%20}" /Volumes/"${share}" && echo "Mounting drive ${share} complete"
fi

}

# Main
CalSMB columba Public "${Autoprober}" &
CalSMB sbnetapp PubStore "${Autoprober}" &
CalSMB columba Optical\ Comp "${Autoprober}" &

wait
